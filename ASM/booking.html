<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ƒê·∫∑t ph√≤ng ‚Ä¢ Hotel Booking</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <style>
        :root{
            --primary: #9C27B0;
            --primary-light: #d999d9;
            --primary-dark: #7B1FA2;
            --bg: #f7f7f9;
            --text: #333;
            --success: #4CAF50;
            --error: #f44336;
            --warning: #FF9800;
            --border: #e0e0e0;
        }
        
        *{box-sizing:border-box;margin:0;padding:0;font-family:Nunito,Roboto,Arial,sans-serif;}
        body{background:var(--bg);color:var(--text);line-height:1.6;}
        a{text-decoration:none;color:inherit;}
        .container{width:90%;max-width:1200px;margin:0 auto;}

        /* Header */
        header{background:#fff;padding:15px 0;box-shadow:0 2px 4px rgba(0,0,0,.08);margin-bottom:30px;}
        .header-flex{display:flex;justify-content:space-between;align-items:center;}
        .logo{font-size:24px;font-weight:700;color:var(--primary);}
        .back-link{color:var(--primary);font-weight:600;padding:8px 16px;border:2px solid var(--primary);border-radius:20px;transition:all 0.3s;}
        .back-link:hover{background:var(--primary);color:#fff;}

        /* Progress Steps */
        .progress-steps{
            background:#fff;padding:30px;border-radius:12px;margin-bottom:30px;
            box-shadow:0 2px 8px rgba(0,0,0,.08);
        }
        .steps{display:flex;justify-content:center;align-items:center;gap:20px;}
        .step{
            display:flex;align-items:center;gap:10px;padding:10px 20px;
            border-radius:25px;transition:all 0.3s;
        }
        .step.active{background:var(--primary);color:#fff;}
        .step.completed{background:var(--success);color:#fff;}
        .step-number{
            width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,0.2);
            display:flex;align-items:center;justify-content:center;font-weight:bold;
        }
        .step:not(.active):not(.completed) .step-number{background:var(--border);color:var(--text);}

        /* Main Content */
        .booking-container{display:grid;grid-template-columns:1fr 350px;gap:30px;}
        
        /* Left Column - Form */
        .booking-form{background:#fff;padding:30px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);}
        .form-section{margin-bottom:30px;}
        .section-title{font-size:20px;font-weight:700;color:var(--primary);margin-bottom:20px;display:flex;align-items:center;gap:10px;}
        
        .form-group{margin-bottom:20px;}
        .form-group label{display:block;margin-bottom:8px;font-weight:600;color:var(--text);}
        .form-group input, .form-group select, .form-group textarea{
            width:100%;padding:12px 16px;border:2px solid var(--border);
            border-radius:8px;font-size:15px;transition:border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus{
            outline:none;border-color:var(--primary);
        }
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:15px;}
        
        .guest-info{background:var(--bg);padding:20px;border-radius:8px;margin-bottom:15px;}
        .guest-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;}
        .add-guest{background:var(--primary-light);color:#fff;border:none;padding:8px 15px;border-radius:20px;cursor:pointer;font-size:12px;}
        .remove-guest{background:var(--error);color:#fff;border:none;padding:5px 10px;border-radius:15px;cursor:pointer;font-size:11px;}

        .special-requests textarea{resize:vertical;min-height:80px;}
        
        /* Terms */
        .terms{display:flex;align-items:flex-start;gap:10px;margin-bottom:20px;}
        .terms input{width:auto;margin:0;}
        
        /* Submit Button */
        .submit-btn{
            width:100%;background:var(--primary);color:#fff;border:none;
            padding:15px;border-radius:8px;font-size:18px;font-weight:700;
            cursor:pointer;transition:all 0.3s;
        }
        .submit-btn:hover{background:var(--primary-dark);transform:translateY(-1px);}
        .submit-btn:disabled{background:#ccc;cursor:not-allowed;transform:none;}

        /* Right Column - Summary */
        .booking-summary{background:#fff;padding:25px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);height:fit-content;position:sticky;top:30px;}
        .summary-title{font-size:18px;font-weight:700;color:var(--primary);margin-bottom:20px;}
        
        .room-preview{margin-bottom:20px;}
        .room-image{width:100%;height:120px;border-radius:8px;object-fit:cover;margin-bottom:10px;}
        .room-name{font-weight:700;margin-bottom:5px;}
        .room-details{color:#666;font-size:14px;}
        
        .booking-details{margin-bottom:20px;}
        .detail-row{display:flex;justify-content:space-between;margin-bottom:8px;padding:8px 0;}
        .detail-row:not(:last-child){border-bottom:1px solid #f0f0f0;}
        .detail-label{color:#666;}
        .detail-value{font-weight:600;}
        
        .price-breakdown{border-top:2px solid var(--primary);padding-top:15px;}
        .price-row{display:flex;justify-content:space-between;margin-bottom:8px;}
        .price-row.total{font-size:18px;font-weight:700;color:var(--primary);}
        
        .policies{background:var(--bg);padding:15px;border-radius:8px;margin-top:20px;}
        .policies h4{margin-bottom:10px;color:var(--primary);}
        .policies ul{font-size:13px;color:#666;line-height:1.5;}
        
        /* Messages */
        .message{padding:15px;border-radius:8px;margin-bottom:20px;display:none;}
        .message.show{display:block;}
        .error{background:#ffebee;color:var(--error);border-left:4px solid var(--error);}
        .success{background:#e8f5e8;color:var(--success);border-left:4px solid var(--success);}
        
        /* Loading */
        .loading{display:none;text-align:center;padding:20px;}
        .loading.show{display:block;}
        .spinner{border:3px solid #f3f3f3;border-top:3px solid var(--primary);border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:0 auto 10px;}
        @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

        /* Mobile Responsive */
        @media(max-width:768px){
            .booking-container{grid-template-columns:1fr;gap:20px;}
            .form-row{grid-template-columns:1fr;}
            .steps{flex-direction:column;gap:10px;}
            .step{width:100%;justify-content:center;}
        }
    </style>
</head>

<body>

    <header>
        <div class="container header-flex">
            <a href="main.html" class="logo">üè® HotelBooking</a>
            <a href="javascript:history.back()" class="back-link">‚Üê Quay l·∫°i</a>
        </div>
    </header>

    <div class="container">
        
        <div class="progress-steps">
            <div class="steps">
                <div class="step active">
                    <div class="step-number">1</div>
                    <span>Th√¥ng tin</span>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <span>X√°c nh·∫≠n</span>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <span>Ho√†n t·∫•t</span>
                </div>
            </div>
        </div>

        <div id="errorMessage" class="message error"></div>
        <div id="successMessage" class="message success"></div>
        
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>ƒêang x·ª≠ l√Ω ƒë·∫∑t ph√≤ng...</p>
        </div>

        <div class="booking-container" id="bookingContainer">
            
            <div class="booking-form">
                <form id="bookingForm">
                    
                    <div class="form-section">
                        <h3 class="section-title">
                            üìÖ Th·ªùi gian l∆∞u tr√∫
                        </h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="checkinDateInput">Ng√†y nh·∫≠n ph√≤ng *</label>
                                <input type="date" id="checkinDateInput" name="checkin_date" required>
                            </div>
                            <div class="form-group">
                                <label for="checkoutDateInput">Ng√†y tr·∫£ ph√≤ng *</label>
                                <input type="date" id="checkoutDateInput" name="checkout_date" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title">
                            üë§ Th√¥ng tin kh√°ch h√†ng
                        </h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fullName">H·ªç v√† t√™n *</label>
                                <input type="text" id="fullName" name="fullName" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email *</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="phone">S·ªë ƒëi·ªán tho·∫°i *</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="nationality">Qu·ªëc t·ªãch</label>
                                <select id="nationality" name="nationality">
                                    <option value="VN">Vi·ªát Nam</option>
                                    <option value="US">Hoa K·ª≥</option>
                                    <option value="CN">Trung Qu·ªëc</option>
                                    <option value="KR">H√†n Qu·ªëc</option>
                                    <option value="JP">Nh·∫≠t B·∫£n</option>
                                    <option value="Other">Kh√°c</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">
                            üë• Th√¥ng tin kh√°ch ƒëi c√πng
                            <button type="button" class="add-guest" onclick="addGuest()">+ Th√™m kh√°ch</button>
                        </h3>
                        <div id="guestsList">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">üìù Y√™u c·∫ßu ƒë·∫∑c bi·ªát</h3>
                        <div class="form-group special-requests">
                            <label for="requests">Ghi ch√∫ th√™m (t√πy ch·ªçn)</label>
                            <textarea id="requests" name="requests" placeholder="VD: Ph√≤ng t·∫ßng cao, gi∆∞·ªùng ƒë√¥i, kh√¥ng h√∫t thu·ªëc..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="terms">
                            <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
                            <label for="agreeTerms">
                                T√¥i ƒë·ªìng √Ω v·ªõi <a href="#" style="color:var(--primary);">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a> 
                                v√† <a href="#" style="color:var(--primary);">Ch√≠nh s√°ch b·∫£o m·∫≠t</a> c·ªßa HotelBooking
                            </label>
                        </div>
                        
                        <div class="terms">
                            <input type="checkbox" id="agreePolicy" name="agreePolicy" required>
                            <label for="agreePolicy">
                                T√¥i x√°c nh·∫≠n th√¥ng tin tr√™n l√† ch√≠nh x√°c v√† ƒë·ªìng √Ω v·ªõi 
                                <a href="#" style="color:var(--primary);">Ch√≠nh s√°ch h·ªßy ƒë·∫∑t ph√≤ng</a>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn" id="submitBtn" disabled>
                        üéØ X√°c nh·∫≠n ƒë·∫∑t ph√≤ng
                    </button>
                    
                    <input type="hidden" id="roomIdInput" name="room_id">
                    <input type="hidden" id="totalPriceInput" name="total_price">
                </form>
            </div>

            <div class="booking-summary">
                <h3 class="summary-title">üìã T√≥m t·∫Øt ƒë·∫∑t ph√≤ng</h3>
                
                <div class="room-preview">
                    <img id="roomImage" class="room-image" src="download (3).jfif" alt="Room">
                    <div id="roomName" class="room-name">Deluxe Sea View</div>
                    <div id="roomDetails" class="room-details">30 m¬≤ ‚Ä¢ 1 gi∆∞·ªùng ƒë√¥i ‚Ä¢ Ban c√¥ng nh√¨n bi·ªÉn</div>
                </div>

                <div class="booking-details">
                    <div class="detail-row">
                        <span class="detail-label">üìÖ Nh·∫≠n ph√≤ng:</span>
                        <span id="checkinDate" class="detail-value">--/--/----</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">üìÖ Tr·∫£ ph√≤ng:</span>
                        <span id="checkoutDate" class="detail-value">--/--/----</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">üåô S·ªë ƒë√™m:</span>
                        <span id="nights" class="detail-value">0 ƒë√™m</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">üë• S·ªë kh√°ch:</span>
                        <span id="guestCount" class="detail-value">1 ng∆∞·ªùi l·ªõn</span>
                    </div>
                </div>

                <div class="price-breakdown">
                    <div class="price-row">
                        <span>Gi√° ph√≤ng / ƒë√™m:</span>
                        <span id="roomPrice">0 ‚Ç´</span>
                    </div>
                    <div class="price-row">
                        <span>Thu·∫ø v√† ph√≠ d·ªãch v·ª•:</span>
                        <span id="taxFee">0 ‚Ç´</span>
                    </div>
                    <div class="price-row total">
                        <span>T·ªïng c·ªông:</span>
                        <span id="totalPrice">0 ‚Ç´</span>
                    </div>
                </div>

                <div class="policies">
                    <h4>üìú Ch√≠nh s√°ch quan tr·ªçng</h4>
                    <ul>
                        <li>‚Ä¢ Check-in: 14:00 - 24:00</li>
                        <li>‚Ä¢ Check-out: 06:00 - 12:00</li>
                        <li>‚Ä¢ H·ªßy mi·ªÖn ph√≠ tr∆∞·ªõc 24h</li>
                        <li>‚Ä¢ Kh√¥ng ho√†n ti·ªÅn sau 24h</li>
                        <li>‚Ä¢ Tr·∫ª em d∆∞·ªõi 12 tu·ªïi mi·ªÖn ph√≠</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let guestCount = 1;
        let roomData = null; // Bi·∫øn ƒë·ªÉ l∆∞u tr·ªØ th√¥ng tin ph√≤ng ƒë√£ t·∫£i

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadInitialData();
            setupFormValidation();
            setupDateInputs();
        });

        // Load initial data from URL parameters and update summary
        function loadInitialData() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('room');
            const checkin = urlParams.get('checkin');
            const checkout = urlParams.get('checkout');
            const guests = urlParams.get('guests') || 1;
            
            // G√°n gi√° tr·ªã t·ª´ URL cho c√°c input ng√†y v√† input ·∫©n
            if (roomId) document.getElementById('roomIdInput').value = roomId;
            if (checkin) document.getElementById('checkinDateInput').value = checkin;
            if (checkout) document.getElementById('checkoutDateInput').value = checkout;

            // C·∫≠p nh·∫≠t s·ªë kh√°ch
            document.getElementById('guestCount').textContent = guests + ' ng∆∞·ªùi l·ªõn';

            // T·∫£i th√¥ng tin ph√≤ng v√† c·∫≠p nh·∫≠t gi√°
            if (roomId) {
                loadRoomData(roomId, checkin, checkout);
            } else {
                // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p kh√¥ng c√≥ roomId
                showMessage('error', 'Kh√¥ng t√¨m th·∫•y th√¥ng tin ph√≤ng. Vui l√≤ng ch·ªçn l·∫°i ph√≤ng.');
            }
        }
        
        // Setup date input event listeners
        function setupDateInputs() {
            const checkinInput = document.getElementById('checkinDateInput');
            const checkoutInput = document.getElementById('checkoutDateInput');
            
            // ƒê·∫∑t gi·ªõi h·∫°n ng√†y t·ªëi thi·ªÉu
            const today = new Date().toISOString().split('T')[0];
            checkinInput.min = today;
            checkoutInput.min = today;
            
            checkinInput.addEventListener('change', updateSummary);
            checkoutInput.addEventListener('change', updateSummary);
        }

        // Update summary with data from form inputs
        function updateSummary() {
            const checkinDateStr = document.getElementById('checkinDateInput').value;
            const checkoutDateStr = document.getElementById('checkoutDateInput').value;
            const roomId = document.getElementById('roomIdInput').value;
            
            if (checkinDateStr && checkoutDateStr) {
                const checkin = new Date(checkinDateStr);
                const checkout = new Date(checkoutDateStr);
                
                if (checkout <= checkin) {
                    showMessage('error', 'Ng√†y tr·∫£ ph√≤ng ph·∫£i sau ng√†y nh·∫≠n ph√≤ng.');
                    document.getElementById('checkoutDateInput').value = '';
                    return;
                }
                
                const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));
                
                document.getElementById('checkinDate').textContent = formatDate(checkinDateStr);
                document.getElementById('checkoutDate').textContent = formatDate(checkoutDateStr);
                document.getElementById('nights').textContent = nights + ' ƒë√™m';
                
                // C·∫≠p nh·∫≠t gi√° d·ª±a tr√™n s·ªë ƒë√™m m·ªõi
                if (roomData) {
                    updatePricing(nights, roomData.price);
                }
            } else {
                // Reset summary if dates are not valid
                document.getElementById('checkinDate').textContent = '--/--/----';
                document.getElementById('checkoutDate').textContent = '--/--/----';
                document.getElementById('nights').textContent = '0 ƒë√™m';
                if (roomData) {
                    updatePricing(0, roomData.price);
                } else {
                    updatePricing(0, 0);
                }
            }
            validateForm(); // Re-validate form on date change
        }

        // Format date for display
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // Load room data (mock function)
        function loadRoomData(roomId, checkin, checkout) {
            // In real app, this would fetch from server
            const rooms = {
                1: {name: 'Deluxe Sea View', price: 1500000, image: 'download (3).jfif', details: '30 m¬≤ ‚Ä¢ 1 gi∆∞·ªùng ƒë√¥i ‚Ä¢ Ban c√¥ng nh√¨n bi·ªÉn'},
                2: {name: 'Family Suite', price: 2800000, image: 'download (4).jfif', details: '50 m¬≤ ‚Ä¢ 2 gi∆∞·ªùng ƒë√¥i ‚Ä¢ Ph√≤ng kh√°ch'},
                3: {name: 'Standard City View', price: 950000, image: 'download (5).jfif', details: '25 m¬≤ ‚Ä¢ 1 gi∆∞·ªùng ƒë∆°n ‚Ä¢ C·ª≠a s·ªï th√†nh ph·ªë'},
                4: {name: 'Private Pool Villa', price: 6500000, image: 'download (6).jfif', details: '120 m¬≤ ‚Ä¢ 2 ph√≤ng ng·ªß ‚Ä¢ H·ªì b∆°i ri√™ng'}
            };
            
            roomData = rooms[roomId] || rooms[1];
            
            document.getElementById('roomName').textContent = roomData.name;
            document.getElementById('roomImage').src = roomData.image;
            document.getElementById('roomDetails').textContent = roomData.details;
            
            let nights = 0;
            if (checkin && checkout) {
                const checkinDate = new Date(checkin);
                const checkoutDate = new Date(checkout);
                nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
                document.getElementById('checkinDate').textContent = formatDate(checkin);
                document.getElementById('checkoutDate').textContent = formatDate(checkout);
                document.getElementById('nights').textContent = nights + ' ƒë√™m';
            }
            
            updatePricing(nights, roomData.price);
        }

        // Update pricing calculation
        function updatePricing(nights, roomPrice) {
            const subtotal = roomPrice * nights;
            const tax = Math.round(subtotal * 0.1); // 10% tax
            const total = subtotal + tax;
            
            document.getElementById('roomPrice').textContent = formatCurrency(roomPrice);
            document.getElementById('taxFee').textContent = formatCurrency(tax);
            document.getElementById('totalPrice').textContent = formatCurrency(total);
            document.getElementById('totalPriceInput').value = total;
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND',
                minimumFractionDigits: 0
            }).format(amount).replace('‚Ç´', '‚Ç´');
        }

        // Add guest form
        function addGuest() {
            if (guestCount >= 4) {
                showMessage('error', 'T·ªëi ƒëa 4 kh√°ch cho m·ªói ph√≤ng');
                return;
            }
            
            guestCount++;
            const guestsList = document.getElementById('guestsList');
            const guestDiv = document.createElement('div');
            guestDiv.className = 'guest-info';
            guestDiv.innerHTML = `
                <div class="guest-header">
                    <strong>Kh√°ch #${guestCount}</strong>
                    <button type="button" class="remove-guest" onclick="removeGuest(this)">X√≥a</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>H·ªç v√† t√™n</label>
                        <input type="text" name="guestName[]" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="guestEmail[]">
                    </div>
                </div>
            `;
            guestsList.appendChild(guestDiv);
            validateForm();
        }

        // Remove guest form
        function removeGuest(button) {
            button.closest('.guest-info').remove();
            guestCount--;
            updateGuestNumbers();
            validateForm();
        }

        // Update guest numbers after removal
        function updateGuestNumbers() {
            const guests = document.querySelectorAll('.guest-info strong');
            guests.forEach((guest, index) => {
                guest.textContent = `Kh√°ch #${index + 2}`;
            });
        }

        // Show message box
        function showMessage(type, message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            
            errorDiv.classList.remove('show');
            successDiv.classList.remove('show');
            
            if (type === 'error') {
                errorDiv.textContent = message;
                errorDiv.classList.add('show');
            } else if (type === 'success') {
                successDiv.textContent = message;
                successDiv.classList.add('show');
            }
        }

        // Setup form validation
        function setupFormValidation() {
            const form = document.getElementById('bookingForm');
            
            // Check form validity on input
            form.addEventListener('input', validateForm);
            form.addEventListener('change', validateForm);
            
            // Handle form submission
            form.addEventListener('submit', handleSubmit);
        }

        // Validate form
        function validateForm() {
            const form = document.getElementById('bookingForm');
            const submitBtn = document.getElementById('submitBtn');
            
            const checkinDate = document.getElementById('checkinDateInput').value;
            const checkoutDate = document.getElementById('checkoutDateInput').value;
            
            let isValid = form.checkValidity(); // checkValidity() t√≠ch h·ª£p s·∫µn c·ªßa HTML5

            // Custom date validation
            if (!checkinDate || !checkoutDate || new Date(checkoutDate) <= new Date(checkinDate)) {
                isValid = false;
            }

            // Custom checks
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const agreePolicy = document.getElementById('agreePolicy').checked;

            if (!agreeTerms || !agreePolicy) {
                isValid = false;
            }

            // Enable/disable submit button
            submitBtn.disabled = !isValid;
        }

        // Handle form submission
        function handleSubmit(e) {
            e.preventDefault();
            
            if (!validateFormData()) {
                return;
            }
            
            const form = document.getElementById('bookingForm');
            const formData = new FormData(form);
            
            // Show loading
            document.getElementById('loading').classList.add('show');
            document.getElementById('bookingContainer').style.display = 'none';
            showMessage('none'); // X√≥a th√¥ng b√°o c≈©

            // G·ª≠i d·ªØ li·ªáu b·∫±ng Fetch API ƒë·∫øn booking.php
            fetch('booking.php', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Server returned status code ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // ·∫®n loading
                document.getElementById('loading').classList.remove('show');
                
                if (data.status === 'success') {
                    showMessage('success', data.message);
                    // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang x√°c nh·∫≠n sau 2 gi√¢y
                    setTimeout(() => {
                        window.location.href = `confirmation.php?booking_id=${data.booking_id}`;
                    }, 2000);
                } else {
                    document.getElementById('bookingContainer').style.display = 'grid';
                    showMessage('error', data.message);
                }
            })
            .catch(error => {
                // ·∫®n loading v√† hi·ªÉn th·ªã l·∫°i form
                document.getElementById('loading').classList.remove('show');
                document.getElementById('bookingContainer').style.display = 'grid';
                console.error('L·ªói khi g·ª≠i y√™u c·∫ßu:', error);
                showMessage('error', 'C√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh x·ª≠ l√Ω. Vui l√≤ng th·ª≠ l·∫°i.');
            });
        }

        // Validate form data
        function validateFormData() {
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const checkinDate = document.getElementById('checkinDateInput').value;
            const checkoutDate = document.getElementById('checkoutDateInput').value;
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showMessage('error', 'Email kh√¥ng h·ª£p l·ªá');
                return false;
            }
            
            // Phone validation (cho ph√©p kho·∫£ng tr·∫Øng)
            const phoneRegex = /^[0-9\s]{10,15}$/;
            if (!phoneRegex.test(phone)) {
                showMessage('error', 'S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá');
                return false;
            }

            // Date validation
            if (!checkinDate || !checkoutDate || new Date(checkoutDate) <= new Date(checkinDate)) {
                showMessage('error', 'Ng√†y tr·∫£ ph√≤ng ph·∫£i sau ng√†y nh·∫≠n ph√≤ng.');
                return false;
            }

            return true;
        }
    </script>
</body>
</html>